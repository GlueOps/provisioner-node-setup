
events {
    worker_connections 1024;  # Defines the maximum number of simultaneous connections
}

http {
    # Set up the cache directory and parameters
    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m inactive=48h use_temp_path=off;

    # # Buffer settings for large file transfers
    # client_max_body_size 12g;  # Allow for even larger file uploads (12GB here for safety margin)
    # client_body_buffer_size 256k;  # Increased buffer for client request body
    # proxy_buffer_size 128k;  # Buffer size for proxy connection header
    # proxy_buffers 32 128k;  # Number of buffers and their size for proxy response
    # proxy_busy_buffers_size 512k;  # Maximum buffer size for busy connections
    
    server {
        listen 80;

        location / {
            # Proxy pass to the remote server
            proxy_pass https://cde-images.glueopshosted.com/;  # Replace with your remote server URL
            proxy_ssl_server_name on;
            proxy_set_header Host cde-images.glueopshosted.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # Enable proxy caching
            proxy_cache my_cache;

            # Cache expiry settings
            proxy_cache_valid 200 48h;   # Cache 200 responses for 48 hours
            proxy_cache_valid 404 1m;    # Cache 404 responses for 1 minute
            proxy_cache_use_stale error timeout updating;
            
            # Add headers to show the cache status (HIT, MISS, etc.)
            add_header X-Cache-Status $upstream_cache_status;
        }
    }
}
